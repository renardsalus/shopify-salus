{{ 'collection-banner.css' | asset_url | stylesheet_tag }}

{%- liquid
  if section.settings.show_collection_description and collection.description != blank
    assign is_description = true
  else
    assign is_description = false
  endif

  assign collection_image_size = section.settings.collection_image
  if section.settings.show_collection_title == false and is_description == false and collection_image_size == 'fill'
    assign collection_image_size = 'natural'
  endif

  if collection_image_size != 'none'
    if section.settings.use_product_image
      assign collection_image_object = collection.all_products.first.featured_media.preview_image
    else
      assign collection_image_object = collection.image
    endif

    assign force_image_ratio = false
    if collection_image_size == 'fill' or collection_image_size == '1.33' or collection_image_size == '1.77' or collection_image_size == '1' or collection_image_size == '0.75'
      assign force_image_ratio = true
      if collection_image_size != 'fill'
        assign image_ratio = collection_image_size
        assign fixed_image_ratio = true
      endif
    endif
  endif

  if collection_image_size != 'none' and collection_image_object
    assign collection_image = true
  else
    assign collection_image = false
  endif

  assign color_scheme = section.settings.color_scheme
-%}
<div
  class="collection-banner {% unless color_scheme == 'default' %} color-scheme color-scheme--{{ color_scheme }}{% endunless %}"
>
  <div class="container">
    <div class="flex flex-col md:flex-row{% if collection_image and collection_image_size != "fill" %} collection-banner--natural{% endif %}{% unless collection_image %} {{ section.settings.text_align }}{% endunless %}{% if section.settings.color_scheme == "default" %} gap-y-6{% endif %}">
      {% if collection_image %}
        {%- capture sizes %}{% render 'sizes-attribute', grid: true, min: 1, md: 2 %}{% endcapture -%}
        {%- liquid
          if force_image_ratio
            assign class = 'img-fit'
          endif
        -%}
        <div
          class="collection-banner__media{% if force_image_ratio == false or collection_image_size == "fill" %} md:pt-0{% endif %}{% if fixed_image_ratio %} md:self-start{% endif %} media relative flex-auto"
          {% if collection_image_size == 'fill' %}
            style="padding-top: {{ 1 | divided_by: collection_image_object.aspect_ratio | times: 100 }}%;"
          {% endif %}
        >
          {% if fixed_image_ratio %}
            <div style="padding-top: {{ 1 | divided_by: image_ratio | times: 100 }}%;">
          {% endif %}

          {% render 'image',
            image: collection_image_object,
            widths: '700, 800, 960, 1296',
            src_width: 1296,
            sizes: sizes,
            lazy_load: false,
            class: class
          %}

          {% if fixed_image_ratio %}
            </div>
          {% endif %}
        </div>
      {%- endif -%}

      {%- if section.settings.show_collection_title or is_description -%}
        <div class="collection-banner__content flex flex-col {% unless collection_image %}w-full {% endunless %}{{ section.settings.text_align }}{% if section.settings.text_width == "wide" or collection_image_size == "natural" %} collection-banner__content-wide{% endif %}{% if collection_image %} collection-banner__content--with-media{% elsif section.settings.text_align == "items-center text-center" %} mx-auto{% endif %}">
          {%- if section.settings.show_collection_title -%}
            <div class="block">
              <h1 class="collection-banner__heading mb-0 inline">
                {{- collection.title | escape -}}
              </h1>

              {% if section.settings.show_product_count %}
                <span class="font-heading collection-banner__count{% unless section.settings.text_align == "text-start" %} block {{ section.settings.text_align }}{% endunless %}">
                  ({{ collection.all_products_count | append: ' ' | append: section.settings.counter_text }})
                </span>
              {% endif %}
            </div>
          {%- endif -%}

          {%- if is_description -%}
            <div class="rte mt-4">
              {{ collection.description }}
            </div>
          {%- endif -%}
        </div>
      {%- endif -%}
    </div>
  </div>
</div>
{% assign show_collection_nav = false %}
{% for link in section.settings.collection_menu.links %}
  {% if link.active or child_link.active %}
    {% assign show_collection_nav = true %}
  {% endif %}
{% endfor %}

{% if section.settings.collection_menu != blank and show_collection_nav %}
  <div class="collection-secondary-nav">
    <div class="container">
      <div class="collection-nav-inner">
        <h2>Collections</h2>
        <div class="col-nav">
          <ul>
            {% for link in section.settings.collection_menu.links %}
              {% if link.active %}
                {% assign link_request_path = request.path | split: '/' | last %}
                {% assign link_handle = link.url | split: '/' | last %}
                <li>
                  <a
                    href="{{ link.url }}"
                    {% if link_request_path == link_handle %}
                      class="active"
                    {% endif %}
                  >
                    {{- link.title -}}
                  </a>
                </li>
                {% if link.links != blank %}
                  {% for childlink in link.links %}
                    {% assign childlink_request_path = request.path | split: '/' | last %}
                    {% assign childlink_handle = childlink.url | split: '/' | last %}

                    <li>
                      <a
                        href="{{ childlink.url }}"
                        {% if childlink_request_path == childlink_handle %}
                          class="active"
                        {% endif %}
                      >
                        {{- childlink.title -}}
                      </a>
                    </li>
                  {% endfor %}
                {% endif %}
              {% endif %}
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
{% endif %}
{% comment %}
  <ul class="tag-filters">
    {% for tag in collection.all_tags %}
      <li class="tag-filters__item">
        <a href="{{ shop.url }}/collections/{{ collection.handle }}/{{ tag | handleize }}">{{ tag }}</a>
      </li>
    {% endfor %}
  </ul>
{% endcomment %}

<!-- section section--template -->
{% schema %}
{
  "name": "Collection banner",
  "class": "cc-collection-banner",
  "settings": [
    {
      "type": "paragraph",
      "content": "Add a description or image by editing your collection. [Learn more](https://help.shopify.com/en/manual/products/collections/collection-layout)"
    },
    {
      "type": "checkbox",
      "id": "show_collection_title",
      "label": "Show collection title",
      "info": "If hidden, you should provide a primary page heading (h1 tag) in another section with h1 option (rich text, image banner, slideshow, video) for SEO purposes.",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_product_count",
      "label": "Show product count",
      "info": "Only visible if the title is shown.",
      "default": true
    },
    {
      "type":"text",
      "id":"counter_text",
      "label":"Counter Text"
    },
    {
      "type": "checkbox",
      "id": "show_collection_description",
      "label": "Show collection description",
      "default": true
    },
    {
      "type": "select",
      "id": "text_align",
      "label": "Content alignment",
      "options": [
        {
          "value": "text-start",
          "label": "Left"
        },
        {
          "value": "items-center text-center",
          "label": "Center"
        },
        {
          "value": "items-end justify-end text-end",
          "label": "Right"
        }
      ],
      "default": "text-start"
    },
    {
      "type": "select",
      "id": "collection_image",
      "label": "Collection image",
      "default": "natural",
      "options": [
        {
          "value": "natural",
          "label": "Natural"
        },
        {
          "value": "1.33",
          "label": "Landscape (4:3)"
        },
        {
          "value": "1.77",
          "label": "Landscape (16:9)"
        },
        {
          "value": "1",
          "label": "Square"
        },
        {
          "value": "0.75",
          "label": "Portrait"
        },
        {
          "label": "Fill",
          "value": "fill"
        },
        {
          "value": "none",
          "label": "None"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "use_product_image",
      "label": "Use the first product image as the collection image",
      "default": false
    },
    {
      "type": "select",
      "id": "text_width",
      "label": "Content width",
      "options": [
        {
          "value": "standard",
          "label": "Standard"
        },
        {
          "value": "wide",
          "label": "Wide"
        }
      ],
      "default": "standard",
      "info": "Does not apply when \"Collection image\" is set to \"Natural\"."
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color scheme",
      "options": [
        {
          "value": "default",
          "label": "Default"
        },
        {
          "value": "1",
          "label": "Scheme 1"
        },
        {
          "value": "2",
          "label": "Scheme 2"
        },
        {
          "value": "3",
          "label": "Scheme 3"
        }
      ],
      "default": "default"
    },
    {
      "type":"header",
      "content":"Collection Menu"
    },
    {
      "type": "link_list",
      "id":"collection_menu",
      "label": "Menu"
    }
  ]
}
{% endschema %}
