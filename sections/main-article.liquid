{{ 'blog.css' | asset_url | stylesheet_tag }}
{{ 'article.css' | asset_url | stylesheet_tag }}
{% comment %}
  {% render 'subscription-popup', popup: section.settings %}
{% endcomment %}

<article class="main-article js-article">
  {%- if section.settings.pagination != 'none' -%}
    {%- if section.settings.pagination != 'standard' -%}
      {{ 'article-pagination.css' | asset_url | stylesheet_tag }}
      <script src="{{ 'article-pagination.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}

    <article-pagination
      class="article__pagination pagination__bar flex justify-between font-bold border-top{% if section.settings.pagination == "standard" %} border-bottom reading-width article-width mx-auto mt-12 lg:blog-mt-16{% else %} bottom-0 left-0 w-full pl-4 pr-4{% endif %}"
    >
    </article-pagination>
  {%- endif -%}
  <div class="article--banner">
    <div class="container">
      <div class="article-banner-content">
        {% if article.metafields.custom.post_category != blank %}
          {% for category in article.metafields.custom.post_category.value %}
            <span class="article-tag">{{ category }}</span>
            {% unless forloop.last %},{% endunless %}
          {% endfor %}
        {% endif %}
        {% comment %}
          {% for tag in article.tags limit: 1 %}
            <span class="article-tag">{{ tag }}</span>
          {% endfor %}
        {% endcomment %}
        <h1 class="mb-0">{{ article.title | escape }}</h1>
        <article-pagination>
          <span
            class="read-time article__pagination--text js-pagination-text no-js-hidden"
            data-show-reading-time="true"
          ></span>
        </article-pagination>
        <div class="artilce-info-wrapper">
          {%- if section.settings.show_author or section.settings.show_date -%}
            {%- if section.settings.show_author -%}
              <div class="article-writer">
                {% if article.metafields.custom.writer_profile != blank %}
                  <img
                    src="{{ article.metafields.custom.writer_profile.value | img_url:'master' }}"
                    alt="Profile Picture"
                  >
                {% else %}
                  <img
                    src="https://cdn.shopify.com/s/files/1/0720/7695/1854/files/profile-placeholder.jpg?v=1724683766"
                    alt="Profile Placeholder"
                  >
                {% endif %}

                <p>
                  Written By: <span>{{ article.author -}}</span>
                </p>
              </div>
            {% endif %}
            <div class="publish-date">
              <p>
                {%- if section.settings.show_date -%}
                  Published:
                  <span>{{ article.published_at | time_tag: format: 'date' }}</span>
                {%- endif -%}
              </p>
            </div>
          {%- endif -%}
        </div>
      </div>
    </div>
  </div>

  <div class="article-body">
    <div class="container">
      {%- if section.settings.show_tags -%}
        {%- capture tag_markup -%}
        <div class="article__tags mb-4 lg:blog-mb-6 last:mb-0 reading-width mx-auto uppercase {{ section.settings.heading_align }}">
          {%- for tag in article.tags -%}
            <a href="{{ tag | link_to_tag: tag | split: 'href="' | last | split: '"' | first }}" class="text-theme-light text-sm">
              {{ tag }}{% unless forloop.last %}, {% endunless %}
            </a>
          {%- endfor -%}
        </div>
      {%- endcapture -%}
        {% if tag_markup contains '</a>' %}{{ tag_markup }}{% endif %}
      {%- endif -%}

      {% comment %}
        <div class="article__title rte mb-6 md:mb-8 last:mb-0 reading-width mx-auto {{ section.settings.heading_align }}">
          <h1 class="mb-0">{{ article.title | escape }}</h1>
        </div>


          {%- if article.image and section.settings.featured_image_width != 'none' -%}
            <div class="article__image article__image--{{ section.settings.featured_image_width }} mb-5 md:blog-mb-6 text-center last:mb-0 mx-auto{% if section.settings.featured_image_width == "page" %} md-down:-mx-gutter{% else %} reading-width article-width{% endif %}">
              <div class="media relative text-center w-full">
                {%- capture sizes -%}
                  {%- render 'sizes-attribute', min: 'page', sm: 'page', md: '800px', lg: false, xl: false, max: false -%}
                {%- endcapture -%}
                {% render 'image',
                  image: article.image,
                  widths: '800, 1200, 1600',
                  src_width: 1600,
                  src_placeholder: true,
                  lazy_load: false,
                  sizes: sizes
                %}
              </div>
            </div>
          {%- endif -%}
      {% endcomment %}

      <div class="main-article-row {% if section.settings.sidebar_content == blank %}no-leftBarr{% endif %}">
        <div class="article-left-sidebar">
          {% comment %}
            <a
              href=""
              class="btn btn--primary download-btn"
              >Download article
              {% render 'icon-article-arrow' %}
            </a>
          {% endcomment %}
          {% comment %}
            {% if section.settings.sidebar_content != blank %}
              <div class="blog-sidebar-filter">
                {% render 'article-list', sidebarContent: section.settings.sidebar_content %}
              </div>
            {% endif %}
          {% endcomment %}
          <div class="blog-sidebar-filter sidebar-content">
            {% render 'article-list', sidebar_content: true %}
          </div>
        </div>
        <div class="article__content rte ">
          <div class="main-article-content">
            {{ article.content }}

            <div class="back-to-blog">
              <a href="{{ blog.url }}" class="btn btn--secondary">
                {%- render 'icon-article-arrow' %} Return to Blog Page</a
              >
            </div>
          </div>

          {% if section.blocks.size > 0 %}
            {% for promotion in section.blocks %}
              <div class="blog-wide-promotion">
                <div
                  class="bw-promotion-inner"
                  {% if promotion.settings.banner_image != blank %}
                    style="background-image:url({{ promotion.settings.banner_image | img_url:'master' }})"
                  {% endif %}
                >
                  <div class="bw-promotion-content">
                    <h2>{{ promotion.settings.heading }}</h2>

                    {% if promotion.settings.btn_label != blank %}
                      <a class="btn btn--secondary" href="{{ promotion.settings.btn_link }}">
                        {{- promotion.settings.btn_label -}}
                      </a>
                    {% endif %}
                    {{ promotion.settings.content }}
                  </div>
                </div>
              </div>
            {% endfor %}
          {% endif %}
        </div>
        <div class="article-right-sidebar">
          <div class="article-info">
            {% if article.metafields.custom.writer_profile != blank %}
              <img
                src="{{ article.metafields.custom.writer_profile.value | img_url:'master' }}"
                alt="Profile Picture"
              >
            {% else %}
              <img
                src="https://cdn.shopify.com/s/files/1/0720/7695/1854/files/profile-placeholder.png?v=1724684028"
                alt="Profile Placeholder"
              >
            {% endif %}

            <p class="author-name">{{ article.author -}}</p>
            {% if section.settings.writer_detail != blank %}
              <div class="author-detail">
                {{ section.settings.writer_detail }}
              </div>
            {% endif %}
            {% if section.settings.show_newsletter %}
              <div class="sidebar-newsletter-form">
                <h3>{{ section.settings.nl_heading }}</h3>
                {% render 'newsletter-signup', id: 'footer-signup', tags: 'newsletter', combined: false %}
              </div>
            {% endif %}
          </div>
        </div>
      </div>

      {%- if section.settings.show_share_buttons -%}
        <div class="social-share reading-width article-width mx-auto flex items-center mt-12 lg:blog-mt-16">
          <p class="social-share__heading mb-0 font-bold">{{ 'general.social.share_heading' | t }}:</p>
          {% render 'social-share', share_title: article.title, share_url: article.url, share_image: article.image %}
        </div>
      {%- endif -%}
    </div>
  </div>
</article>

<script>
  document.querySelectorAll('.article__content table').forEach((table) => {
    const wrapper = document.createElement('div');
    wrapper.className = 'scrollable-table';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  });
</script>

{% render 'structured-data-article', article: article %}
<!-- Get all h2's and add list item -->
<script>
  // Get all h2 elements
  const headings = document.querySelectorAll('.main-article-content h2');
  if(headings.length > 0){
    const ul = document.querySelector('.content-list');
    headings.forEach((heading, index) => {
        const li = document.createElement('li');
        li.textContent = heading.textContent;
        li.addEventListener('click', function () {
            heading.scrollIntoView({ behavior: 'smooth' });
        });
        ul.appendChild(li);
    });
  }else{
    document.querySelector('.sidebar-content').style.display ="none";
  }
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
      const mainArticleContent = document.querySelector('.main-article-content');
      const blogPromotion = document.querySelector('.blog-wide-promotion');
      const backToBlog = document.querySelector('.back-to-blog');

      if (mainArticleContent && blogPromotion) {
          // Find all the h2 elements within .main-article-content
          const h2Elements = mainArticleContent.querySelectorAll('h2');

          // Check if there are at least 2 h2 elements
          if (h2Elements.length >= 2) {
              // Insert .blog-wide-promotion before the second h2 element
              const secondH2 = h2Elements[1];
              mainArticleContent.insertBefore(blogPromotion, secondH2);
          }else{
            // alert('test');
            mainArticleContent.insertBefore(blogPromotion, backToBlog);
          }
      }
  });
</script>
{% schema %}
{
  "name": "Article",
  "class": "cc-main-article section section--template",
  "settings": [
    {
      "type": "header",
      "content": "Article header"
    },
    {
      "type": "checkbox",
      "id": "show_tags",
      "label": "Show tags",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "label": "Show author",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "label": "Show published date",
      "default": true
    },
    {
      "type":"header",
      "content":"Article Sidebars"
    },
    {
      "type":"header",
      "content":"Left Sidebar"
    },
    {
      "type":"header",
      "content":"Right Sidebar",
      "info":"Writer Detail"
    },
    {
      "type":"richtext",
      "id":"writer_detail",
      "label":"Writer Detail"
    },
    {
      "type":"header",
      "content":"Newsletter Form"
    },
    {
      "type":"checkbox",
      "id":"show_newsletter",
      "label":"Show Newsletter",
      "default":true
    },
    {
      "type":"text",
      "id":"nl_heading",
      "label":"Newsletter Heading"
    },

    {
      "type": "header",
      "content": "Article footer"
    },
    {
      "type": "checkbox",
      "id": "show_share_buttons",
      "label": "Show social share links",
      "default": true
    },
    {
      "type": "select",
      "id": "pagination",
      "label": "Next/previous links",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "standard",
          "label": "Standard"
        },
        {
          "value": "bar",
          "label": "Fixed bar"
        },
        {
          "value": "bar-reading",
          "label": "Fixed bar with reading estimate"
        }
      ],
      "default": "standard"
    },
    {
      "type":"header",
      "content": "Popup Content"
    },
    {
      "type":"text",
      "id":"heading",
      "label":"Heading"
    },
    {
      "type":"richtext",
      "id":"content",
      "label":"Content"
    },
    {
      "type":"image_picker",
      "id":"image",
      "label":"Image"
    },
    {
      "type":"text",
      "id":"foem_button_label",
      "label":"Form Button Label"
    }
  ],
  "blocks": [
    {
      "type":"promotion_banner",
      "name":"Promotion Banner",
      "settings": [
        {
          "type":"header",
          "content":"Article Promotion Banner"
        },
        {
          "type":"image_picker",
          "id":"banner_image",
          "label":"Banner Image"
        },
        {
          "type":"text",
          "id":"heading",
          "label":"Heading"
        },
        {
          "type":"richtext",
          "id":"content",
          "label": "Content"
        },
        {
          "type":"text",
          "id":"btn_label",
          "label":"Button Label"
        },
        {
          "type":"url",
          "id":"btn_link",
          "label":"Button Label"
        }

      ]
    },
  ]
}
{% endschema %}
{% comment %}
  PAGINATION CODE-------------------------
    {%- if section.settings.pagination != 'none' -%}
      {%- if section.settings.pagination != 'standard' -%}
        {{ 'article-pagination.css' | asset_url | stylesheet_tag }}
        <script src="{{ 'article-pagination.js' | asset_url }}" defer="defer"></script>
      {%- endif -%}

      <article-pagination class="article__pagination pagination__bar flex justify-between font-bold border-top{% if section.settings.pagination == "standard" %} border-bottom reading-width article-width mx-auto mt-12 lg:blog-mt-16{% else %} bottom-0 left-0 w-full pl-4 pr-4{% endif %}">
        <a
          class="pt-4 pb-4 shrink-0 js-pagination-link has-ltr-icon"
          {% if blog.previous_article %}
            href="{{ blog.previous_article }}" title="{{ blog.previous_article.title | escape }}"
          {% else %}
            role="link" aria-disabled="true"
          {% endif %}
        >
          {% render 'icon-chevron-left' -%}
          <span
            {% if section.settings.pagination == 'bar-reading' %}
              class="hidden md:inline"
            {% endif %}
          >
            {{- 'blogs.article.previous_post' | t -}}
          </span>
        </a>
        {% if section.settings.pagination != 'standard' %}
          <span
            class="article__pagination--text js-pagination-text no-js-hidden p-4 text-theme-text overflow-hidden"
            {% if section.settings.pagination == 'bar-reading' %}
              data-show-reading-time="true"
            {% endif %}
          ></span>
        {% endif %}
        <a
          class="pt-4 pb-4 shrink-0 js-pagination-link has-ltr-icon"
          {% if blog.next_article %}
            href="{{ blog.next_article }}" title="{{ blog.next_article.title | escape }}"
          {% else %}
            role="link" aria-disabled="true"
          {% endif %}
        >
          <span
            {% if section.settings.pagination == 'bar-reading' %}
              class="hidden md:inline"
            {% endif %}
          >
            {{- 'blogs.article.next_post' | t -}}
          </span>
          {%- render 'icon-chevron-right' %}
        </a>
      </article-pagination>
    {%- endif -%}
    PAGINATION CODE END-------------------------
{% endcomment %}
