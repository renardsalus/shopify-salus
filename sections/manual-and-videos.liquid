{{ 'products-grid.css' | asset_url | stylesheet_tag }}
{{ 'product.css' | asset_url | stylesheet_tag }}
<script src="{{ 'products-toolbar.js' | asset_url }}" defer="defer"></script>

{%- if settings.pagination_style == 'modern' or settings.pagination_infinite -%}
  <script src="{{ 'custom-pagination.js' | asset_url }}" defer="defer"></script>
{%- endif -%}

{%- liquid
  if section.settings.card_size_mobile == 'small'
    assign grid_mobile_cols = 'grid-cols-2 small-cards-mobile'
  else
    assign grid_mobile_cols = 'grid-cols-1'
  endif

  if collection.products.size > 0
    if section.settings.card_size == 'small'
      assign grid_classes_filters_open = grid_mobile_cols | append: ' sm:grid-cols-3 xl:grid-cols-4 small-cards-desktop'
      assign grid_classes_filters_closed = grid_mobile_cols | append: ' sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 small-cards-desktop'
    elsif section.settings.card_size == 'medium'
      assign grid_classes_filters_open = grid_mobile_cols | append: ' sm:grid-cols-3'
      assign grid_classes_filters_closed = grid_mobile_cols | append: ' sm:grid-cols-3 xl:grid-cols-4'
    else
      assign grid_classes_filters_open = grid_mobile_cols | append: ' sm:grid-cols-2 xl:grid-cols-3'
      assign grid_classes_filters_closed = grid_mobile_cols | append: ' sm:grid-cols-2 xl:grid-cols-3'
    endif

    if settings.prod_card_image_ratio == 'shortest'
      assign image_ratio = 0
      for product in collection.products
        if product.featured_media.preview_image.aspect_ratio > image_ratio
          assign image_ratio = product.featured_media.preview_image.aspect_ratio
        endif
      endfor
    elsif settings.prod_card_image_ratio == 'tallest'
      assign image_ratio = 99
      for product in collection.products
        if product.featured_media.preview_image.aspect_ratio < image_ratio
          assign image_ratio = product.featured_media.preview_image.aspect_ratio
        endif
      endfor
    else
      assign image_ratio = settings.prod_card_image_ratio
    endif
  endif

  assign compare_toggle = false
  assign compare_visible = false
  if settings.enable_compare
    if settings.compare_toggle == 'none' or settings.compare_toggle == 'toggle_on'
      assign compare_toggle = true
    endif

    if settings.compare_toggle != 'none'
      assign compare_visible = true
    endif
  endif
-%}

<div class="container" data-num-results="{{ collection.products_count }}">
  {%- if section.settings.enable_filtering
    or section.settings.show_layout_toggle
    or section.settings.enable_sorting
    or compare_visible
  -%}
    <script src="{{ 'products-toolbar.js' | asset_url }}" defer="defer"></script>
    {% render 'products-toolbar', results: collection %}
  {%- endif -%}

  {%- paginate collection.products by section.settings.products_per_page -%}
    <custom-pagination
      class="main-products-grid{% if settings.card_contain %} main-products-grid--contained{% endif %} flex"
      data-layout="grid"
      data-compare="{{ compare_toggle }}"
      data-infinite-scroll="{{ settings.pagination_infinite }}"
      data-pause-infinite-scroll="false"
    >
      {%- if collection.filters != empty and section.settings.enable_filtering -%}
        <div
          class="main-products-grid__filters{% if section.settings.filters_open_lg == false %} lg:js-hidden{% endif %}"
          data-all-product="{{ collections['all'].all_products_count }}"
        >
          {% render 'facet-filters', results: collection %}
        </div>
      {%- endif -%}

      <div class="main-products-grid__results relative flex-auto" id="filter-results">
        {%- if collection.products.size == 0 -%}
          <p>{{ 'sections.collection.empty' | t }}</p>
        {%- else -%}
          {%- liquid
            assign active_filters_count = 0
            if collection.filters != empty
              for filter in collection.filters
                if filter.type == 'price_range'
                  if filter.min_value.value
                    assign active_filters_count = active_filters_count | plus: 1
                  endif
                  if filter.max_value.value
                    assign active_filters_count = active_filters_count | plus: 1
                  endif
                else
                  assign active_filters_count = active_filters_count | plus: filter.active_values.size
                endif
              endfor
            endif
          -%}

          <ul
            class="grid mb-8 md:mb-12 {% if section.settings.filters_open_lg %}{{ grid_classes_filters_open }}{% else %}{{ grid_classes_filters_closed }}{% endif %} gap-x-theme {% if settings.card_contain %}gap-y-8{% else %}gap-y-15{% endif %}"
            data-filters-open-classes="grid mb-8 md:mb-12 {{ grid_classes_filters_open }} gap-x-theme {% if settings.card_contain %}gap-y-8{% else %}gap-y-16{% endif %}"
            data-filters-closed-classes="grid mb-8 md:mb-12 {{ grid_classes_filters_closed }} gap-x-theme {% if settings.card_contain %}gap-y-8{% else %}gap-y-16{% endif %}{% unless paginate.pages > 1 %} mb-8 md:mb-12{% endunless %}"
            role="list"
          >
            {%- assign rendered_product_ids = '' -%}
            {%- for product in collection.products -%}
              {%- unless is_last_position and rendered_product_ids contains product.id -%}
                {%- assign rendered_product_ids = rendered_product_ids | append: product.id | append: ',' -%}

                <li class="js-pagination-result">
                  {% render 'manual-and-videos-card',
                    product: product,
                    collection: collection,
                    image_ratio: image_ratio,
                    show_category_tag: true,
                    card_type: section.settings.card_type
                  %}
                </li>
              {%- endunless -%}
            {%- endfor -%}

            {%- comment -%}Process wide promos aligned bottom{%- endcomment -%}
          </ul>

          {%- if paginate.pages > 1 -%}
            {% render 'pagination', paginate: paginate, class: 'mb-10', style: settings.pagination_style %}
          {%- endif -%}
        {%- endif -%}
      </div>
    </custom-pagination>
  {%- endpaginate -%}
</div>

{% schema %}
{
  "name": "Manuals & Videos",
  "class": "cc-collection-products section section--template mb-0 owner-manuals",
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 50,
      "step": 1,
      "label": "Products per page",
      "default": 16
    },
    {
      "type":"select",
      "id":"card_type",
      "label":"Card Type",
      "options":[
        {
          "value":"manual",
          "label":"Owner's Manual"
        },
        {
          "value":"video",
          "label":"Assembly Videos"
        }
      ]
    },
    {
      "type": "select",
      "id": "card_size_mobile",
      "label": "Product card size on mobile",
      "info": "Applies to cards in Grid view only.",
      "options": [
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ],
      "default": "small"
    },
    {
      "type": "select",
      "id": "card_size",
      "label": "Product card size on large screens",
      "info": "Applies to cards in Grid view only.",
      "options": [
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ],
      "default": "medium"
    },
    {
      "type": "header",
      "content": "Toolbar"
    },
    {
      "type": "paragraph",
      "content": "The Compare toggle can be disabled in \"Theme Settings > Product Compare\"."
    },
    {
      "type": "checkbox",
      "id": "show_layout_toggle",
      "label": "Show grid/list layout buttons",
      "default": true
    },
    {
      "type": "header",
      "content": "Filtering"
    },
    {
      "type": "checkbox",
      "id": "enable_filtering",
      "label": "Enable filtering",
      "info": "[Customize filters](/admin/menus)",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "filters_open_lg",
      "label": "Open filters by default on large screens",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "stick_on_scroll",
      "label": "Stick on scroll on large screens",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_filter_counts",
      "label": "Show product counts",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "expand_filters",
      "label": "Expand all filters by default",
      "default": true
    },
    {
      "type": "range",
      "id": "max_filter_options",
      "label": "Visible options per filter",
      "info": "Remaining options will be automatically collapsed.",
      "min": 2,
      "max": 50,
      "step": 1,
      "default": 7
    },
    {
      "type": "header",
      "content": "Sorting"
    },
    {
      "type": "checkbox",
      "id": "enable_sorting",
      "label": "Enable sorting",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_feat_sort_opt",
      "label": "Show 'Featured' option",
      "info": "Add your manually sorted order to the sort options.",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "sort_first",
      "label": "Show the sort options first on mobile",
      "default": true
    }

  ],
  "presets": [
    {
      "name":"Manuals & Videos"
    }
  ]
}
{% endschema %}
