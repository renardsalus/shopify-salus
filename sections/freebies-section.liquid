{% assign freebies_product_images = product.metafields.freebies_images %}
{% assign freebies_product_headings = product.metafields.freebies_headings %}
{% assign freebies_product_details = product.metafields.freebies_details %}
{% if freebies_product_images.size > 0 %}
  {%- comment -%}theme-check-disable LiquidTag{%- endcomment -%}

  {%- if freebies_product_details.size > 0 and freebies_product_headings.size > 0 -%}
    {%- liquid
      # constants
      assign breakpoint_sm = 600
      assign breakpoint_md = 769
      assign breakpoint_lg = 1024

      if section.settings.layout == 'carousel'
        assign carousel = true
        if section.settings.column_size == 'small'
          assign grid_classes = 'grid-flow-col auto-cols-1 sm:auto-cols-2 md:auto-cols-3 lg:auto-cols-4 '
        elsif section.settings.column_size == 'medium'
          assign grid_classes = 'grid-flow-col auto-cols-1 md:auto-cols-2 lg:auto-cols-3'
        else
          assign grid_classes = 'grid-flow-col auto-cols-1 md:auto-cols-2'
        endif

      else
        assign carousel = false
      endif

      assign color_scheme = section.settings.color_scheme

      if section.settings.image_ratio == 'shortest'
        assign image_ratio = 0
        for block in section.blocks
          assign this_image_ratio = block.settings.image.aspect_ratio | default: 1.77
          if this_image_ratio > image_ratio
            assign image_ratio = this_image_ratio
          endif
        endfor
      elsif section.settings.image_ratio == 'tallest'
        assign image_ratio = 99

      else
        assign image_ratio = section.settings.image_ratio
      endif
    -%}
    {%- if carousel == false -%}
      {% style %}
        {% if section.settings.column_size == 'small' %}
          @media (min-width: {{ breakpoint_sm }}px) {
            .freebies-section #{{ section.id }} .multi-column {
              width: calc(50% - var(--column-gap)/2);
              max-width: calc(50% - var(--column-gap)/2);

            }
          }
          @media (min-width: {{ breakpoint_md }}px) {
            .freebies-section #{{ section.id }} .multi-column {
              width: calc((100% / 3) - var(--column-gap)/2);
              max-width: calc((100% / 3) - var(--column-gap)/2);

            }
          }
          @media (min-width: {{ breakpoint_lg }}px) {
            .freebies-section #{{ section.id }}  .multi-column {
              width: calc(25% - var(--column-gap)/2);
              max-width: calc(25% - var(--column-gap)/2);

            }
            .freebies-section .milti-column-sec ul{
              justify-content:center;
            }
          }
        {% else %}
          @media (min-width: {{ breakpoint_md }}px) {
            #{{ section.id }} .multi-column {
              width: calc(50% - var(--column-gap));
            }
          }
          {% if section.settings.column_size == 'medium' %}
            @media (min-width: {{ breakpoint_lg }}px) {
              #{{ section.id }} .multi-column {
                width: calc((100% / 3) - var(--column-gap));
              }
            }
          {% endif %}
        {% endif %}
      {% endstyle %}
    {% else %}
      {% style %}
        #{{section.id}} .lg\:auto-cols-4{
            grid-auto-columns: calc((100% - var(--column-gap) * 6) / 7);
          }
        @media only screen and (max-width: 1600px) {
           #{{section.id}} .lg\:auto-cols-4{
             column-gap:25px;
            grid-auto-columns: calc((100% - 25px * 6) / 7);
          }

         }
      {% endstyle %}
    {%- endif -%}

    {% if freebies_product_images.size > 0 and freebies_product_details.size > 0 %}
      <div
        class="section milti-column-sec freebies-section {% if section.settings.enable_gap %}g-large{% endif %} {% if section.settings.enable_padding %}vertical-pad{% endif %} color-scheme color-scheme--{{- color_scheme -}}"
        id="{{ section.id }}"
      >
        {%- if product.metafields.freebies_main.heading != blank -%}
          <div class="container">
            <div
              class="section__header {% if  product.metafields.freebies_main.heading == blank %}m-0{% endif %} items-center flex{% if section.settings.heading_align == 'text-center' %} flex-col text-center{% elsif section.settings.heading_align == 'text-end' %} flex-row-reverse flex-wrap{% else %} flex-row flex-wrap{% endif %} gap-x-theme"
              {% if settings.animations_enabled != 'disabled' %}
                data-cc-animate
              {% endif %}
            >
              <h2 class="h2 section__heading mb-0 flex-auto {{ section.settings.heading_align }}">
                {{ product.metafields.freebies_main.heading.value }}
              </h2>

              {% if carousel %}
                {%- if section.settings.button_label != blank -%}
                  <a href="{{ section.settings.button_link }}" class="btn">
                    {{- section.settings.button_label | escape -}}
                  </a>
                {%- endif -%}
              {% endif %}
            </div>
          </div>
        {%- endif -%}

        {%- if carousel -%}
          <carousel-slider class="carousel block" inactive>
            <div class="{% if section.settings.enable_fw %}container{% else %}mc-container{% endif %} relative">
              <div class="slider" id="slider-{{ section.id }}">
        {%- endif -%}

        <div class="{% if carousel %}slider-container{% else %} container{% endif %}">
          <ul
            class="{% if carousel %}slider__grid grid {{ grid_classes }}{% else %}{% if section.settings.enable_load_more %}loadMore__items{% endif %} flex flex-wrap{% endif %} gap-x-theme{% if color_scheme == 'none' and carousel == false %} gap-y-12 md:gap-y-6{% else %} gap-y-6{% endif %}"
            role="list"
          >
            {%- for i in (1..freebies_product_details.size) -%}
              {% assign loop_index = forloop.index %}
              <li
                class="multi-column grow w-full max-w-none{% if carousel %} slider__item{% endif %}"
                {% if settings.animations_enabled != 'disabled' %}
                  data-cc-animate data-cc-animate-delay="{{ forloop.index | times: 0.07 }}s"
                {% endif %}
              >
                <div class="card{% if block.settings.video_shopify != blank %} video-section{% endif %}{% unless color_scheme == 'none' %} color-scheme color-scheme--{{ color_scheme }}{% endunless %} relative flex flex-col h-full">
                  {%- liquid
                    if section.settings.column_size == 'small'
                      assign cols = 3
                    else
                      assign cols = 2
                    endif
                    capture sizes
                      render 'sizes-attribute', grid: true, min: 1, md: cols
                    endcapture
                  -%}

                  <div
                    class="card__media media relative w-full{% if section.settings.image_ratio == "natural" %} {{ section.settings.media_align }}{% endif %}"
                  >
                    {% for image in freebies_product_images %}
                      {%- if loop_index == forloop.index %}
                        {% assign image_url = image | last %}
                        {%- liquid
                          assign image_class = 'video-played-hidden'
                          unless section.settings.image_ratio == 'natural'
                            assign image_class = image_class | append: ' img-fit'
                          endunless
                          if section.settings.image_ratio == 'natural' and block.settings.video_shopify != blank
                            assign image_class = image_class | append: ' img-fit'
                          endif
                        -%}
                        {% render 'image',
                          image: image_url,
                          widths: '460, 700, 860, 1296',
                          src_width: 700,
                          sizes: sizes,
                          section_index: section.index,
                          class: image_class
                        %}
                      {%- endif -%}
                    {% endfor %}
                  </div>

                  <div class="card__info flex flex-col flex-auto items-start pt-6{% if section.settings.column_align == 'center' %} text-center items-center{% endif %}">
                    {% for heading in freebies_product_headings %}
                      {%- if forloop.index == loop_index -%}
                        <h3 class="h5 card__title">{{ heading | last }}</h3>
                      {%- endif -%}
                    {% endfor %}

                    {% for detail in freebies_product_details %}
                      {%- if loop_index == forloop.index -%}
                        <div class="card__rte flex-auto rte">
                          {{ detail | last | metafield_tag }}
                        </div>
                      {%- endif -%}
                    {% endfor %}
                  </div>
                </div>
              </li>
            {%- endfor -%}
          </ul>
        </div>

        {%- if carousel -%}
          </div>
          {%- if settings.slider_show_arrows != 'never' -%}
            <div class="slider-nav absolute top-middle end {% if settings.slider_show_arrows == 'hover' %}slider-nav--show-on-hover no-hover-hidden {% endif %}hidden md:block no-js-hidden">
              <button
                type="button"
                class="slider-nav__btn tap-target btn {{ settings.slider_button_style }} has-ltr-icon"
                name="next"
                aria-controls="slider-{{ section.id }}"
              >
                <span class="visually-hidden">{{ 'general.slider.next' | t }}</span>
                {% render 'icon-chevron-right' %}
              </button>
              <button
                type="button"
                class="slider-nav__btn tap-target btn {{ settings.slider_button_style }} has-ltr-icon"
                name="prev"
                aria-controls="slider-{{ section.id }}"
              >
                <span class="visually-hidden">{{ 'general.slider.previous' | t }}</span>
                {% render 'icon-chevron-left' %}
              </button>
            </div>
          {%- endif -%}
          </div>
          </carousel-slider>
        {%- endif -%}
      </div>
    {% endif %}
  {%- endif -%}
{% endif %}
{% schema %}
{
  "name": "Freebies Section",
  "class":"cc-multi-column freebies-section",
  "settings": [
    {
      "type": "header",
      "content": "Section header"
    },
    {
      "type":"checkbox",
      "id":"enable_padding",
      "label":"Enable vertical Spacing"
    },
    {
      "type":"checkbox",
      "id":"enable_gap",
      "label":"Enable More spacing Between cards"
    },
    {
      "type":"checkbox",
      "id": "enable_fw",
      "label": "Full Width"
    },
    {
      "type": "select",
      "id": "heading_align",
      "label": "Heading alignment",
      "options": [
        {
          "value": "text-start",
          "label": "Left"
        },
        {
          "value": "text-center",
          "label": "Center"
        },
        {
          "value": "text-end",
          "label": "Right"
        }
      ],
      "default": "text-start"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "options": [
        {
          "value": "carousel",
          "label": "Carousel"
        },
        {
          "value": "grid",
          "label": "Grid"
        }
      ],
      "default": "carousel"
    },
    {
      "type": "select",
      "id": "column_size",
      "label": "Column size",
      "options": [
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ],
      "default": "medium"
    },
    {
      "type": "select",
      "id": "column_align",
      "label": "Content alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        }
      ],
      "default": "left"
    },
    {
      "type": "select",
      "id": "media_align",
      "label": "Media alignment",
      "info": "Applies to small images with a \"Natural\" aspect ratio.",
      "options": [
        {
          "value": "text-left",
          "label": "Left"
        },
        {
          "value": "text-center",
          "label": "Center"
        }
      ],
      "default": "text-center"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Media aspect ratio",
      "options": [
        {
          "value": "natural",
          "label": "Natural"
        },
        {
          "value": "shortest",
          "label": "Height of shortest image"
        },
        {
          "value": "tallest",
          "label": "Height of tallest image"
        },
        {
          "value": "1.77",
          "label": "Landscape"
        },
        {
          "value": "1",
          "label": "Square"
        },
        {
          "value": "0.75",
          "label": "Portrait"
        }
      ],
      "default": "1"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color scheme",
      "options": [
        {
          "value": "none",
          "label": "Default"
        },
        {
          "value": "1",
          "label": "Scheme 1"
        },
        {
          "value": "2",
          "label": "Scheme 2"
        },
        {
          "value": "3",
          "label": "Scheme 3"
        },
        {
          "value": "4",
          "label": "Scheme 4"
        }
      ],
      "default": "1"
    }
  ],
  "presets": [
    {
      "name":"Freebies Section"
    }
  ]
}
{% endschema %}
